<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>YouTube Event Logger</title>
</head>
<body>
  <h2>YouTube Player with Event Logging</h2>
  <div id="player"></div>

  <script>
    // Load YouTube IFrame API
    var tag = document.createElement('script');
    tag.src = "https://www.youtube.com/iframe_api";
    document.head.appendChild(tag);

    let player;

    function onYouTubeIframeAPIReady() {
      player = new YT.Player('player', {
        height: '390',
        width: '640',
        videoId: 'dQw4w9WgXcQ', // ðŸ‘ˆ replace with your sample videoId
        events: {
          'onReady': onPlayerReady,
          'onStateChange': onPlayerStateChange
        }
      });
    }

    function onPlayerReady() {
      console.log("Player ready");
    }

    async function logEvent(eventData) {
      console.log("Logging event:", eventData);
      try {
        await fetch("https://blue-sunset-9b47.akshay-n.workers.dev/", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(eventData),
        });
      } catch (err) {
        console.error("Logging failed:", err);
      }
    }

    function onPlayerStateChange(event) {
      let state;
      switch (event.data) {
        case YT.PlayerState.PLAYING:
          state = "play";
          break;
        case YT.PlayerState.PAUSED:
          state = "pause";
          break;
        case YT.PlayerState.ENDED:
          state = "ended";
          break;
        case YT.PlayerState.BUFFERING:
          state = "buffering";
          break;
        case YT.PlayerState.CUED:
          state = "cued";
          break;
        default:
          state = "unstarted";
      }

      logEvent({
        event: state,
        videoTime: player.getCurrentTime(),
        videoId: player.getVideoData().video_id
      });
    }
  </script>
</body>
</html>
